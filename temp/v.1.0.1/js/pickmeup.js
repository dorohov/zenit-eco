!function(e,t){"function"==typeof define&&define.amd?define(t):"object"==typeof exports?module.exports=t():e.pickmeup=t()}(this,function(){function e(e,t,n){if(n=n||[],e instanceof Element)t.apply(t,[e].concat(n));else{var a,i;for(a=e.length,i=0;i<a;++i)t.apply(t,[e[i]].concat(n))}}function t(t){e(t,function(e){e.parentElement.removeChild(e)})}function n(e,t){var n=e;do n=n.parentElement;while(n&&!a(n,t));return n}function a(e,t){return(e.matches||e.webkitMatchesSelector||e.msMatchesSelector).call(e,t)}function i(e,t){return e&&e.classList.contains(t)}function r(e,t){e.classList.add(t)}function o(e,t){e.classList.remove(t)}function u(e,t){return e.querySelector(t)}function s(e,t){return Array.prototype.slice.call(e.querySelectorAll(t))}function d(e,t,n,a){if(n.indexOf(" ")!==-1){var i,r=n.split(" "),o=r.length;for(i=0;i<o;++i)d(e,t,r[i],a)}else e.__pickmeup.events.push([t,n,a]),t.addEventListener(n,a)}function l(e,t,n,a){var i,r,o;if(n&&n.indexOf(" ")!==-1)for(i=n.split(" "),r=i.length,o=0;o<r;++o)l(e,t,i[o],a);else for(i=e.__pickmeup.events,r=i.length,o=0;o<r;++o)t&&t!=i[o][0]||n&&n!=i[o][1]||a&&a!=i[o][2]||i[o][0].removeEventListener(i[o][1],i[o][2])}function c(e){var t=e.getBoundingClientRect();return{top:t.top+window.pageYOffset-document.documentElement.clientTop,left:t.left+window.pageXOffset-document.documentElement.clientLeft}}function m(e,t,n){var a=document.createEvent("Event");return n&&(a.detail=n),a.initEvent("pickmeup-"+t,!1,!0),e.dispatchEvent(a)}function p(e){for(var t=new Date(e),n=28,a=t.getMonth();t.getMonth()==a;)++n,t.setDate(n);return n-1}function f(e,t){e.setDate(e.getDate()+t)}function h(e,t){var n=e.getDate();e.setDate(1),e.setMonth(e.getMonth()+t),e.setDate(Math.min(n,p(e)))}function v(e,t){var n=e.getDate();e.setDate(1),e.setFullYear(e.getFullYear()+t),e.setDate(Math.min(n,p(e)))}function _(e){var t=new Date(e.getFullYear(),e.getMonth(),e.getDate(),0,0,0),n=new Date(e.getFullYear(),0,0,0,0,0),a=t-n;return Math.floor(a/24*60*60*1e3)}function w(e){var n,a,o,d,l,c,p=e.__pickmeup.element,_=e.__pickmeup.options,w=Math.floor(_.calendars/2),g=_.date,k=_.current,D=_.min?new Date(_.min):null,M=_.max?new Date(_.max):null;D&&(D.setDate(1),h(D,1),f(D,-1)),M&&(M.setDate(1),h(M,1),f(M,-1)),t(s(p,".pmu-instance > :not(nav)"));for(var x=0;x<_.calendars;x++)if(n=new Date(k),y(n),o=s(p,".pmu-instance")[x],i(p,"pmu-view-years")?(v(n,12*(x-w)),a=n.getFullYear()-6+" - "+(n.getFullYear()+5)):i(p,"pmu-view-months")?(v(n,x-w),a=n.getFullYear()):i(p,"pmu-view-days")&&(h(n,x-w),a=b(n,_.title_format,_.locales[_.locale])),!l&&M&&(c=new Date(n),_.select_day?h(c,_.calendars-1):_.select_month?v(c,_.calendars-1):v(c,12*(_.calendars-1)),c>M))--x,h(k,-1),l=void 0;else if(l=new Date(n),!d&&(d=new Date(n),d.setDate(1),h(d,1),f(d,-1),D&&D>d))--x,h(k,1),d=void 0;else{u(o,".pmu-month").textContent=a;var Y=function(e){return"range"==_.mode&&e>=new Date(g[0]).getFullYear()&&e<=new Date(g[1]).getFullYear()||"multiple"==_.mode&&g.reduce(function(e,t){return e.push(new Date(t).getFullYear()),e},[]).indexOf(e)!==-1||new Date(g).getFullYear()==e},F=function(e,t){var n=new Date(g[0]).getFullYear(),a=new Date(g[1]).getFullYear(),i=new Date(g[0]).getMonth(),r=new Date(g[1]).getMonth();return"range"==_.mode&&(e>n&&e<a||e>n&&e==a&&t<=r||e==n&&e<a&&t>=i||e==n&&e==a&&t>=i&&t<=r)||"multiple"==_.mode&&g.reduce(function(e,t){return t=new Date(t),e.push(t.getFullYear()+"-"+t.getMonth()),e},[]).indexOf(e+"-"+t)!==-1||new Date(g).getFullYear()==e&&new Date(g).getMonth()==t};!function(){var e,t,a,i=[],u=n.getFullYear()-6,s=new Date(_.min).getFullYear(),d=new Date(_.max).getFullYear();for(a=0;a<12;++a)e=u+a,t=document.createElement("div"),t.textContent=e,t.__pickmeup_year=e,_.min&&e<s||_.max&&e>d?r(t,"pmu-disabled"):Y(e)&&r(t,"pmu-selected"),i.push(t);o.appendChild(_.instance_content_template(i,"pmu-years"))}(),function(){var e,t,a=[],i=n.getFullYear(),u=new Date(_.min).getFullYear(),s=new Date(_.min).getMonth(),d=new Date(_.max).getFullYear(),l=new Date(_.max).getMonth();for(e=0;e<12;++e)t=document.createElement("div"),t.textContent=_.locales[_.locale].monthsShort[e],t.__pickmeup_month=e,t.__pickmeup_year=i,_.min&&(i<u||e<s&&i==u)||_.max&&(i>d||e>l&&i>=d)?r(t,"pmu-disabled"):F(i,e)&&r(t,"pmu-selected"),a.push(t);o.appendChild(_.instance_content_template(a,"pmu-months"))}(),function(){var e,t,a,i,u,s,d=[],l=n.getMonth(),c=y(new Date).valueOf();for(function(){n.setDate(1);var e=(n.getDay()-_.first_day)%7;f(n,-(e+(e<0?7:0)))}(),e=0;e<42;++e)t=document.createElement("div"),t.textContent=n.getDate(),t.__pickmeup_day=n.getDate(),t.__pickmeup_month=n.getMonth(),t.__pickmeup_year=n.getFullYear(),l!=n.getMonth()&&r(t,"pmu-not-in-month"),0==n.getDay()?r(t,"pmu-sunday"):6==n.getDay()&&r(t,"pmu-saturday"),a=_.render(new Date(n))||{},i=y(new Date(n)).valueOf(),u=_.min&&_.min>n||_.max&&_.max<n,s=_.date.valueOf()==i||_.date instanceof Array&&_.date.reduce(function(e,t){return e||i===t.valueOf()},!1)||"range"==_.mode&&i>=_.date[0]&&i<=_.date[1],a.disabled||!("disabled"in a)&&u?r(t,"pmu-disabled"):(a.selected||!("selected"in a)&&s)&&r(t,"pmu-selected"),i==c&&r(t,"pmu-today"),a.class_name&&a.class_name.split(" ").forEach(r.bind(t,t)),d.push(t),f(n,1);o.appendChild(_.instance_content_template(d,"pmu-days"))}()}d.setDate(1),l.setDate(1),h(l,1),f(l,-1);var S=u(p,".pmu-prev"),E=u(p,".pmu-next");S&&(S.style.visibility=_.min&&_.min>=d?"hidden":"visible"),E&&(E.style.visibility=_.max&&_.max<=l?"hidden":"visible"),m(e,"fill")}function g(e,t){var n,a=t.format,i=t.separator,r=t.locales[t.locale];if(e instanceof Date||e instanceof Number)return y(new Date(e));if(!e)return y(new Date);if(e instanceof Array){for(e=e.slice(),n=0;n<e.length;++n)e[n]=g(e[n],t);return e}var o=e.split(i);if(o.length>1)return o.forEach(function(e,n,a){a[n]=g(e.trim(),t)}),o;i=[].concat(r.daysShort,r.daysMin,r.days,r.monthsShort,r.months),i=i.map(function(e){return"("+e+")"}),i=new RegExp("[^0-9a-zA-Z"+i.join("")+"]+");var u,s,d,l,c,m=e.split(i),p=a.split(i),f=new Date;for(n=0;n<m.length;n++)switch(p[n]){case"b":s=r.monthsShort.indexOf(m[n]);break;case"B":s=r.months.indexOf(m[n]);break;case"d":case"e":u=parseInt(m[n],10);break;case"m":s=parseInt(m[n],10)-1;break;case"Y":case"y":d=parseInt(m[n],10),d+=d>100?0:d<29?2e3:1900;break;case"H":case"I":case"k":case"l":l=parseInt(m[n],10);break;case"P":case"p":/pm/i.test(m[n])&&l<12?l+=12:/am/i.test(m[n])&&l>=12&&(l-=12);break;case"M":c=parseInt(m[n],10)}var h=new Date(void 0===d?f.getFullYear():d,void 0===s?f.getMonth():s,void 0===u?f.getDate():u,void 0===l?f.getHours():l,void 0===c?f.getMinutes():c,0);return isNaN(1*h)&&(h=new Date),y(h)}function y(e){return e.setHours(0,0,0,0),e}function b(e,t,n){var a=e.getMonth(),i=e.getDate(),r=e.getFullYear(),o=e.getDay(),u=e.getHours(),s=u>=12,d=s?u-12:u,l=_(e);0==d&&(d=12);for(var c,m=e.getMinutes(),p=e.getSeconds(),f=t.split(""),h=0;h<f.length;h++){switch(c=f[h]){case"a":c=n.daysShort[o];break;case"A":c=n.days[o];break;case"b":c=n.monthsShort[a];break;case"B":c=n.months[a];break;case"C":c=1+Math.floor(r/100);break;case"d":c=i<10?"0"+i:i;break;case"e":c=i;break;case"H":c=u<10?"0"+u:u;break;case"I":c=d<10?"0"+d:d;break;case"j":c=l<100?l<10?"00"+l:"0"+l:l;break;case"k":c=u;break;case"l":c=d;break;case"m":c=a<9?"0"+(1+a):1+a;break;case"M":c=m<10?"0"+m:m;break;case"p":case"P":c=s?"PM":"AM";break;case"s":c=Math.floor(e.getTime()/1e3);break;case"S":c=p<10?"0"+p:p;break;case"u":c=o+1;break;case"w":c=o;break;case"y":c=(""+r).substr(2,2);break;case"Y":c=r}f[h]=c}return f.join("")}function k(e,t){var n,i=e.__pickmeup.options;y(t),function(){var e;switch(i.mode){case"multiple":for(e=t.valueOf(),n=0;n<i.date.length;++n)if(i.date[n].valueOf()===e)return void i.date.splice(n,1);i.date.push(t);break;case"range":i.lastSel||(i.date[0]=t),t<=i.date[0]?(i.date[1]=i.date[0],i.date[0]=t):i.date[1]=t,i.lastSel=!i.lastSel;break;default:i.date=t.valueOf()}}();var r=M(i);a(e,"input")&&(e.value="single"==i.mode?r.formatted_date:r.formatted_date.join(i.separator)),m(e,"change",r),i.flat||!i.hide_on_select||"range"==i.mode&&i.lastSel||i.bound.hide()}function D(e,t){var u=t.target;if(i(u,"pmu-button")||(u=n(u,".pmu-button")),!i(u,"pmu-button")||i(u,"pmu-disabled"))return!1;t.preventDefault(),t.stopPropagation();var d=e.__pickmeup.options,l=n(u,".pmu-instance"),c=l.parentElement,m=s(c,".pmu-instance").indexOf(l);if(a(u.parentElement,"nav"))i(u,"pmu-month")?(h(d.current,m-Math.floor(d.calendars/2)),i(c,"pmu-view-years")?("single"!=d.mode?d.current=new Date(d.date[d.date.length-1]):d.current=new Date(d.date),d.select_day?(o(c,"pmu-view-years"),r(c,"pmu-view-days")):d.select_month&&(o(c,"pmu-view-years"),r(c,"pmu-view-months"))):i(c,"pmu-view-months")?d.select_year?(o(c,"pmu-view-months"),r(c,"pmu-view-years")):d.select_day&&(o(c,"pmu-view-months"),r(c,"pmu-view-days")):i(c,"pmu-view-days")&&(d.select_month?(o(c,"pmu-view-days"),r(c,"pmu-view-months")):d.select_year&&(o(c,"pmu-view-days"),r(c,"pmu-view-years")))):i(u,"pmu-prev")?d.bound.prev(!1):d.bound.next(!1);else if(i(c,"pmu-view-years"))d.current.setFullYear(u.__pickmeup_year),d.select_month?(o(c,"pmu-view-years"),r(c,"pmu-view-months")):d.select_day?(o(c,"pmu-view-years"),r(c,"pmu-view-days")):d.bound.update_date(d.current);else if(i(c,"pmu-view-months"))d.current.setMonth(u.__pickmeup_month),d.current.setFullYear(u.__pickmeup_year),d.select_day?(o(c,"pmu-view-months"),r(c,"pmu-view-days")):d.bound.update_date(d.current),h(d.current,Math.floor(d.calendars/2)-m);else{var p=new Date(d.current);p.setYear(u.__pickmeup_year),p.setMonth(u.__pickmeup_month),p.setDate(u.__pickmeup_day),d.bound.update_date(p)}return d.bound.fill(),!0}function M(e){var t;return"single"==e.mode?(t=new Date(e.date),{formatted_date:b(t,e.format,e.locales[e.locale]),date:t}):(t={formatted_date:[],date:[]},e.date.forEach(function(n){var a=new Date(n);t.formatted_date.push(b(a,e.format,e.locales[e.locale])),t.date.push(a)}),t)}function x(e,t){var n,r=e.__pickmeup.element;if(t||i(r,"pmu-hidden")){var u=e.__pickmeup.options,s=c(e),l={l:window.pageXOffset,t:window.pageYOffset,w:document.documentElement.clientWidth,h:document.documentElement.clientHeight},p=s.top,f=s.left;if(u.bound.fill(),a(e,"input")&&(n=e.value,n&&u.bound.set_date(n),d(e,e,"keydown",function(e){9==e.which&&u.bound.hide()}),u.lastSel=!1),!m(e,"show"))return;if(!u.flat){switch(u.position){case"top":p-=r.offsetHeight;break;case"left":f-=r.offsetWidth;break;case"right":f+=e.offsetWidth;break;case"bottom":p+=e.offsetHeight}p+r.offsetHeight>l.t+l.h&&(p=s.top-r.offsetHeight),p<l.t&&(p=s.top+e.offsetHeight),f+r.offsetWidth>l.l+l.w&&(f=s.left-r.offsetWidth),f<l.l&&(f=s.left+e.offsetWidth),r.style.top=p+"px",r.style.left=f+"px",o(r,"pmu-hidden"),setTimeout(function(){d(e,document.documentElement,"click",u.bound.hide),d(e,window,"resize",u.bound.forced_show)})}}}function Y(e,t){var n=e.__pickmeup.element,a=e.__pickmeup.options;t&&t.target&&(t.target==e||16&n.compareDocumentPosition(t.target))||m(e,"hide")&&(r(n,"pmu-hidden"),l(e,document.documentElement,"click",a.bound.hide),l(e,window,"resize",a.bound.forced_show),a.lastSel=!1)}function F(e){var t=e.__pickmeup.options;l(e,document.documentElement,"click",t.bound.hide),l(e,window,"resize",t.bound.forced_show),t.bound.forced_show()}function S(e){var t=e.__pickmeup.options;"single"!=t.mode&&(t.date=[],t.lastSel=!1,t.bound.fill())}function E(e,t){"undefined"==typeof t&&(t=!0);var n=e.__pickmeup.element,a=e.__pickmeup.options;i(n,"pmu-view-years")?v(a.current,-12):i(n,"pmu-view-months")?v(a.current,-1):i(n,"pmu-view-days")&&h(a.current,-1),t&&a.bound.fill()}function O(e,t){"undefined"==typeof t&&(t=!0);var n=e.__pickmeup.element,a=e.__pickmeup.options;i(n,"pmu-view-years")?v(a.current,12):i(n,"pmu-view-months")?v(a.current,1):i(n,"pmu-view-days")&&h(a.current,1),t&&a.bound.fill()}function A(e,t){var n=e.__pickmeup.options,a=M(n);if("string"==typeof t){var i=a.date;return i instanceof Date?b(i,t,n.locales[n.locale]):i.map(function(e){return b(e,t,n.locales[n.locale])})}return a[t?"formatted_date":"date"]}function C(e,t,n){var i,r=e.__pickmeup.options;if(!(t instanceof Array)||t.length>0)if(r.date=g(t,r),"single"!=r.mode)for(r.date instanceof Array?(r.date[0]=r.date[0]||g(new Date,r),"range"==r.mode&&(r.date[1]=r.date[1]||g(r.date[0],r))):(r.date=[r.date],"range"==r.mode&&r.date.push(g(r.date[0],r))),i=0;i<r.date.length;++i)r.date[i]=T(r.date[i],r.min,r.max);else r.date instanceof Array&&(r.date=r.date[0]),r.date=T(r.date,r.min,r.max);else r.date=[];if(!r.select_day)if(r.date instanceof Array)for(i=0;i<r.date.length;++i)r.date[i].setDate(1);else r.date.setDate(1);if("multiple"==r.mode)for(i=0;i<r.date.length;++i)r.date.indexOf(r.date[i])!==i&&(r.date.splice(i,1),--i);if(n?r.current=g(n,r):(n="single"===r.mode?r.date:r.date[r.date.length-1],r.current=n?new Date(n):new Date),r.current.setDate(1),r.bound.fill(),a(e,"input")&&r.default_date!==!1){var o=M(r),u=e.value,s="single"==r.mode?o.formatted_date:o.formatted_date.join(r.separator);u||m(e,"change",o),u!=s&&(e.value=s)}}function H(e){var n=e.__pickmeup.element;l(e),t(n),delete e.__pickmeup}function T(e,t,n){return t&&t>e?new Date(t):n&&n<e?new Date(n):e}function W(e,t){if("string"==typeof e&&(e=document.querySelector(e)),!e)return null;if(!e.__pickmeup){var n,a,i={};t=t||{};for(n in W.defaults)i[n]=n in t?t[n]:W.defaults[n];for(n in i)a=e.getAttribute("data-pmu-"+n),null!==a&&(i[n]=a);"days"!=i.view||i.select_day||(i.view="months"),"months"!=i.view||i.select_month||(i.view="years"),"years"!=i.view||i.select_year||(i.view="days"),"days"!=i.view||i.select_day||(i.view="months"),i.calendars=Math.max(1,parseInt(i.calendars,10)||1),i.mode=/single|multiple|range/.test(i.mode)?i.mode:"single",i.min&&(i.min=g(i.min,i),i.select_day||i.min.setDate(1)),i.max&&(i.max=g(i.max,i),i.select_day||i.max.setDate(1));var o=document.createElement("div");e.__pickmeup={options:i,events:[],element:o},o.__pickmeup_target=e,r(o,"pickmeup"),i.class_name&&r(o,i.class_name),i.bound={fill:w.bind(e,e),update_date:k.bind(e,e),click:D.bind(e,e),show:x.bind(e,e),forced_show:x.bind(e,e,!0),hide:Y.bind(e,e),update:F.bind(e,e),clear:S.bind(e,e),prev:E.bind(e,e),next:O.bind(e,e),get_date:A.bind(e,e),set_date:C.bind(e,e),destroy:H.bind(e,e)},r(o,"pmu-view-"+i.view);var u=i.instance_template(i),s="";for(n=0;n<i.calendars;++n)s+=u;o.innerHTML=s,d(e,o,"click",i.bound.click),d(e,o,"onselectstart"in Element.prototype?"selectstart":"mousedown",function(e){e.preventDefault()}),i.flat?(r(o,"pmu-flat"),e.appendChild(o)):(r(o,"pmu-hidden"),document.body.appendChild(o),d(e,e,"click",x.bind(e,e,!1)),d(e,e,"input",i.bound.update),d(e,e,"change",i.bound.update)),i.bound.set_date(i.date,i.current)}return i=e.__pickmeup.options,{hide:i.bound.hide,show:i.bound.show,clear:i.bound.clear,update:i.bound.update,prev:i.bound.prev,next:i.bound.next,get_date:i.bound.get_date,set_date:i.bound.set_date,destroy:i.bound.destroy}}return W.defaults={current:null,date:new Date,default_date:new Date,flat:!1,first_day:1,prev:"&#9664;",next:"&#9654;",mode:"single",select_year:!0,select_month:!0,select_day:!0,view:"days",calendars:1,format:"d-m-Y",title_format:"B, Y",position:"bottom",class_name:"",separator:" - ",hide_on_select:!1,min:null,max:null,render:function(){},locale:"en",locales:{en:{days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],daysShort:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],daysMin:["Su","Mo","Tu","We","Th","Fr","Sa"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],monthsShort:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]}},instance_template:function(e){var t=e.locales[e.locale].daysMin.slice();return e.first_day&&t.push(t.shift()),'<div class="pmu-instance"><nav><div class="pmu-prev pmu-button">'+e.prev+'</div><div class="pmu-month pmu-button"></div><div class="pmu-next pmu-button">'+e.next+'</div></nav><nav class="pmu-day-of-week"><div>'+t.join("</div><div>")+"</div></nav></div>"},instance_content_template:function(e,t){var n=document.createElement("div");r(n,t);for(var a=0;a<e.length;++a)r(e[a],"pmu-button"),n.appendChild(e[a]);return n}},W});